from pycaret.regression import load_model, predict_model
import streamlit as st
import pandas as pd
import numpy as np

from pycaret.nlp import *
#from pycaret.classification import *
from pycaret.regression import *

from pathlib import Path
from pycaret.nlp import *
from pycaret.classification import *

from sklearn.feature_extraction.text import CountVectorizer



#model = load_model('deployment_review_to_ratings_04082022')
model = load_model('deployment_04112022')
model_rating = load_model('deployment_review_to_ratings_04122022')

new_predict_df= pd.DataFrame(columns=['19th',
 '20th',
 'abagnale',
 'able',
 'about',
 'absolutely',
 'academy',
 'account',
 'action',
 'actual',
 'actually',
 'adventure',
 'after',
 'again',
 'against',
 'age',
 'ago',
 'all',
 'allison',
 'almost',
 'alone',
 'along',
 'already',
 'also',
 'although',
 'always',
 'am',
 'amazing',
 'american',
 'amount',
 'an',
 'and',
 'anita',
 'another',
 'any',
 'anyone',
 'anything',
 'are',
 'argeneau',
 'around',
 'articles',
 'as',
 'at',
 'attention',
 'author',
 'authors',
 'available',
 'away',
 'back',
 'bad',
 'bank',
 'based',
 'battle',
 'be',
 'became',
 'because',
 'become',
 'becomes',
 'bed',
 'been',
 'before',
 'begin',
 'beginning',
 'begins',
 'behind',
 'being',
 'believe',
 'bennie',
 'best',
 'better',
 'between',
 'big',
 'birthday',
 'bit',
 'bite',
 'black',
 'bliss',
 'blood',
 'book',
 'books',
 'boring',
 'both',
 'bought',
 'bourgeoisie',
 'brennan',
 'brief',
 'bring',
 'business',
 'but',
 'buy',
 'by',
 'call',
 'came',
 'can',
 'cannot',
 'capital',
 'capitalism',
 'capitalist',
 'care',
 'carrie',
 'case',
 'catch',
 'cause',
 'century',
 'certainly',
 'chance',
 'chandler',
 'change',
 'chapter',
 'chapters',
 'character',
 'characters',
 'child',
 'children',
 'civil',
 'class',
 'classes',
 'clear',
 'clearly',
 'cm_cr_arp_d_rvw_txt',
 'collection',
 'college',
 'come',
 'comes',
 'coming',
 'communism',
 'communist',
 'compelling',
 'complete',
 'completely',
 'con',
 'concept',
 'content',
 'control',
 'copy',
 'could',
 'couldn',
 'country',
 'couple',
 'course',
 'cover',
 'created',
 'crime',
 'critique',
 'culture',
 'danger',
 'dark',
 'data',
 'daughter',
 'day',
 'days',
 'dead',
 'deal',
 'death',
 'decided',
 'definitely',
 'descriptions',
 'despite',
 'detail',
 'details',
 'detective',
 'developed',
 'development',
 'dialogue',
 'did',
 'didn',
 'diet',
 'different',
 'difficult',
 'disappointed',
 'division',
 'do',
 'does',
 'doesn',
 'doing',
 'don',
 'done',
 'down',
 'dp',
 'dr',
 'due',
 'during',
 'each',
 'earlier',
 'early',
 'easily',
 'easy',
 'economic',
 'economics',
 'edition',
 'either',
 'else',
 'emily',
 'end',
 'ending',
 'engels',
 'engine',
 'enjoy',
 'enjoyable',
 'enjoyed',
 'enough',
 'entertaining',
 'entire',
 'equal',
 'era',
 'especially',
 'essay',
 'etc',
 'etna',
 'european',
 'even',
 'events',
 'eventually',
 'ever',
 'every',
 'everyone',
 'everything',
 'evil',
 'exactly',
 'example',
 'excellent',
 'except',
 'exciting',
 'existence',
 'existing',
 'expect',
 'expected',
 'experience',
 'face',
 'fact',
 'fall',
 'family',
 'fan',
 'far',
 'fast',
 'father',
 'favorite',
 'fbi',
 'feel',
 'feeling',
 'feels',
 'felt',
 'female',
 'fett',
 'few',
 'fiction',
 'figure',
 'finally',
 'find',
 'finds',
 'finish',
 'finished',
 'fire',
 'first',
 'five',
 'follow',
 'following',
 'food',
 'for',
 'force',
 'forced',
 'forward',
 'found',
 'four',
 'frank',
 'franklin',
 'free',
 'friends',
 'from',
 'full',
 'fully',
 'fun',
 'funny',
 'further',
 'future',
 'gave',
 'general',
 'genre',
 'get',
 'gets',
 'getting',
 'give',
 'given',
 'gives',
 'giving',
 'glad',
 'glycemic',
 'go',
 'god',
 'goes',
 'going',
 'good',
 'got',
 'government',
 'great',
 'greg',
 'group',
 'guy',
 'had',
 'half',
 'hand',
 'happened',
 'happy',
 'hard',
 'has',
 'have',
 'having',
 'he',
 'help',
 'her',
 'here',
 'herself',
 'hicks',
 'high',
 'higher',
 'highly',
 'him',
 'himself',
 'his',
 'historical',
 'history',
 'hold',
 'home',
 'hook',
 'hope',
 'house',
 'how',
 'however',
 'href',
 'human',
 'husband',
 'idea',
 'ideas',
 'ie',
 'if',
 'immediately',
 'important',
 'in',
 'industrial',
 'information',
 'instead',
 'interest',
 'interested',
 'interesting',
 'into',
 'intriguing',
 'introduced',
 'introduction',
 'involved',
 'is',
 'isn',
 'issues',
 'it',
 'its',
 'itself',
 'jack',
 'jane',
 'jedi',
 'job',
 'judy',
 'julia',
 'just',
 'justice',
 'karl',
 'keep',
 'kept',
 'kill',
 'killed',
 'killing',
 'kincaid',
 'kind',
 'kindle',
 'knew',
 'know',
 'known',
 'ky',
 'labor',
 'language',
 'large',
 'last',
 'later',
 'law',
 'lead',
 'learn',
 'least',
 'leave',
 'left',
 'less',
 'let',
 'life',
 'light',
 'like',
 'liked',
 'line',
 'link',
 'linked',
 'lisa',
 'lissi',
 'lissianna',
 'list',
 'little',
 'live',
 'lives',
 'living',
 'll',
 'load',
 'local',
 'long',
 'longer',
 'look',
 'looking',
 'looks',
 'lost',
 'lot',
 'love',
 'loved',
 'low',
 'lynsay',
 'machinery',
 'machines',
 'made',
 'main',
 'major',
 'make',
 'makes',
 'making',
 'man',
 'manifesto',
 'manufactured',
 'many',
 'market',
 'marlowe',
 'marriage',
 'marx',
 'master',
 'matter',
 'may',
 'maybe',
 'mayes',
 'mcgavock',
 'me',
 'mean',
 'means',
 'men',
 'mentioned',
 'middle',
 'might',
 'military',
 'mill',
 'mind',
 'missing',
 'modern',
 'money',
 'moon',
 'more',
 'most',
 'mother',
 'movie',
 'mr',
 'ms',
 'much',
 'murder',
 'must',
 'my',
 'myself',
 'mystery',
 'name',
 'near',
 'necessary',
 'need',
 'needed',
 'needs',
 'never',
 'new',
 'news',
 'newspaper',
 'next',
 'nice',
 'nicholas',
 'night',
 'no',
 'normal',
 'not',
 'nothing',
 'novel',
 'novels',
 'now',
 'number',
 'observation',
 'obsession',
 'of',
 'off',
 'often',
 'ok',
 'old',
 'on',
 'once',
 'one',
 'ones',
 'only',
 'or',
 'order',
 'original',
 'other',
 'others',
 'otherwise',
 'our',
 'out',
 'over',
 'overall',
 'own',
 'page',
 'pages',
 'paper',
 'paranormal',
 'part',
 'particular',
 'particularly',
 'parts',
 'passion',
 'past',
 'people',
 'perfect',
 'perhaps',
 'person',
 'personal',
 'philosophy',
 'pick',
 'pigeon',
 'place',
 'places',
 'plot',
 'point',
 'political',
 'poor',
 'possible',
 'post',
 'power',
 'present',
 'presented',
 'pretty',
 'previous',
 'price',
 'prison',
 'private',
 'probably',
 'problem',
 'problems',
 'product',
 'production',
 'productive',
 'professor',
 'proletariat',
 'property',
 'published',
 'put',
 'questions',
 'quick',
 'quickly',
 'quite',
 'rate',
 'rates',
 'rather',
 'rating',
 're',
 'read',
 'reader',
 'readers',
 'reading',
 'real',
 'reality',
 'really',
 'reason',
 'reasons',
 'recommend',
 'ref',
 'relations',
 'relationship',
 'rest',
 'return',
 'review',
 'reviews',
 'revolution',
 'rich',
 'right',
 'romance',
 'romantic',
 'rosato',
 'said',
 'same',
 'sands',
 'save',
 'saved',
 'say',
 'saying',
 'says',
 'scenes',
 'scottoline',
 'second',
 'section',
 'see',
 'seem',
 'seemed',
 'seems',
 'seen',
 'self',
 'sense',
 'series',
 'set',
 'several',
 'sex',
 'she',
 'ship',
 'short',
 'should',
 'shreve',
 'side',
 'sight',
 'simple',
 'simply',
 'since',
 'sister',
 'slave',
 'slow',
 'small',
 'so',
 'social',
 'society',
 'some',
 'someone',
 'something',
 'sometimes',
 'somewhat',
 'sort',
 'source',
 'south',
 'sowell',
 'space',
 'speak',
 'spoilers',
 'stand',
 'star',
 'stars',
 'start',
 'started',
 'starts',
 'state',
 'states',
 'steam',
 'still',
 'stories',
 'story',
 'strong',
 'style',
 'subject',
 'subscription',
 'such',
 'sure',
 'suspense',
 'system',
 'take',
 'takes',
 'taking',
 'tale',
 'tassel',
 'tell',
 'tells',
 'text',
 'than',
 'thanks',
 'that',
 'the',
 'their',
 'them',
 'themselves',
 'then',
 'there',
 'these',
 'they',
 'thing',
 'things',
 'think',
 'thinking',
 'this',
 'thomas',
 'those',
 'though',
 'thought',
 'three',
 'through',
 'throughout',
 'thus',
 'tied',
 'time',
 'times',
 'to',
 'today',
 'together',
 'told',
 'tony',
 'too',
 'took',
 'trading',
 'travel',
 'trial',
 'tribe',
 'trilogy',
 'true',
 'truly',
 'try',
 'trying',
 'turn',
 'turns',
 'twist',
 'two',
 'ultimately',
 'under',
 'understand',
 'understanding',
 'unfortunately',
 'unique',
 'until',
 'up',
 'upon',
 'us',
 'use',
 'used',
 'usually',
 'utf8',
 'value',
 'vampire',
 'vampires',
 'van',
 'various',
 'vatta',
 've',
 'version',
 'very',
 'view',
 'villain',
 'volume',
 'vong',
 'wait',
 'want',
 'wanted',
 'wants',
 'war',
 'was',
 'wasn',
 'way',
 'ways',
 'we',
 'wealth',
 'weight',
 'well',
 'went',
 'were',
 'what',
 'when',
 'where',
 'whether',
 'which',
 'while',
 'who',
 'whole',
 'whose',
 'why',
 'wife',
 'will',
 'wish',
 'with',
 'within',
 'without',
 'woman',
 'women',
 'won',
 'wonderful',
 'word',
 'words',
 'work',
 'workers',
 'working',
 'works',
 'world',
 'worth',
 'would',
 'write',
 'writer',
 'writes',
 'writing',
 'written',
 'wrong',
 'wrote',
 'year',
 'years',
 'yes',
 'yet',
 'you',
 'young',
 'your',
 'derived_ratings'])

def predict(model, input_df):
   
     
    st.success('The input is {}'.format(input_df))
    predictions_df = predict_model(model, input_df)
    
    st.success('The input is {}'.format(input_df))
    predictions = predictions_df['Label'][0]
    return predictions



def run():

    add_selectbox = st.sidebar.selectbox(
    "How would you like to predict?",
    ("Online", "Batch"))

    st.sidebar.info('This app is created to predict review for Kindle books from Amazon')
      
    st.title("Kindle book reviews Prediction App")

    if add_selectbox == 'Online':

        user_review = st.text_input('User Review', value='Enter your Review')
      
        output=""

        input_dict = {'user_review' : user_review}
        input_df = pd.DataFrame([input_dict])

             
        tf_vectorizer = CountVectorizer()
        features = tf_vectorizer.fit_transform(input_df['user_review'].apply(lambda features : np.str_(features)))
        features_df = pd.DataFrame(features.toarray(), columns=tf_vectorizer.get_feature_names())

        dummy = new_predict_df.head(1)
        dummy[dummy > 0] = 0
                

        for col in dummy:
            try:
                dummy[col] = features_df[col]
            except:
                pass

        predict_df = dummy.fillna(0)
        
        
        
        
        if st.button("Predict"):
           
            st.success('INPUT : {}'.format(user_review))
       
            #output = predict(model=model, input_df=predict_df)
            output = model.predict(predict_df)
            #output = '$' + str(output)
            if output == 1 :
                prcd = "positive"
            if output == 0 :
                prcd = "negative"
                
            rating = model_rating.predict(predict_df)    
                
            prcd = str(prcd) 
            prcd1 = rating
            st.success('OUTPUT :  This is a {} review '.format(prcd))
            st.success('Predicted user rating is {}'.format(prcd1))
            
    if add_selectbox == 'Batch':
            file_upload = st.file_uploader("Upload csv file for prediction",type = ["csv"])
            
            if file_upload is not None:
                data = pd.read_csv(file_upload)
                
                tf_vectorizer = CountVectorizer()
                features = tf_vectorizer.fit_transform(data['reviewText'].apply(lambda features : np.str_(features)))
                features_df = pd.DataFrame(features.toarray(), columns=tf_vectorizer.get_feature_names())

                dummy = new_predict_df.head(1)
                dummy[dummy > 0] = 0
                

                for col in dummy:
                    try:
                        dummy[col] = features_df[col]
                    except:
                        pass

                predict_df = dummy.fillna(0)
        

                st.success('Predicted user ratings are : ')
                predictions = model_rating.predict(predict_df)  
                st.write(predictions)

if __name__ == '__main__':
    run()








